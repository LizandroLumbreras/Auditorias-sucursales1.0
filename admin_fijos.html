<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin – Lista Fija Auditoría</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Poppins',sans-serif;
  background:#eef3ff;
  padding:20px;
}
h2{ text-align:center; color:#00416A; }

.card{
  background:white; padding:20px; border-radius:12px;
  box-shadow:0 4px 15px rgba(0,0,0,.1); max-width:650px; margin:auto;
}

input{
  width:100%; padding:12px; border-radius:8px;
  border:1px solid #ccc; margin-top:10px;
}

button{
  padding:12px 20px; border:none; border-radius:8px;
  background:#00416A; color:white; cursor:pointer;
}

.item{
  padding:12px; background:#f7f7f7;
  border-radius:8px; margin-top:10px;
  display:flex; justify-content:space-between; align-items:center;
}
.remove{
  background:#d9534f; border:none; color:white;
  border-radius:6px; padding:6px 10px; cursor:pointer;
}
</style>
</head>

<body>

<h2>Administrar Lista Fija de Auditoría</h2>

<div class="card">

  <h3>Agregar nuevo producto fijo</h3>
  <input id="codigo" placeholder="Código">
  <input id="concepto" placeholder="Descripción">
  <button onclick="agregar()">Agregar</button>

  <hr>

  <h3>Lista Actual</h3>
  <div id="lista"></div>

  <button style="margin-top:20px; width:100%;" onclick="guardar()">Guardar Cambios</button>

</div>

<script type="module">
import { db } from "./firebase.js";
import { doc, getDoc, setDoc }
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

let lista = [];
const divLista = document.getElementById("lista");

async function cargar(){
    const ref = doc(db, "fijos_auditoria", "productos");
    const snap = await getDoc(ref);

    if(snap.exists()){
        lista = snap.data().lista || [];
    }

    render();
}

function render(){
    divLista.innerHTML = "";
    lista.forEach((p, i)=>{
        divLista.innerHTML += `
          <div class="item">
            <div>
              <b>${p.concepto}</b><br>
              <small>${p.codigo}</small>
            </div>
            <button class="remove" onclick="eliminar(${i})">X</button>
          </div>
        `;
    });
}

window.eliminar = function(i){
    lista.splice(i,1);
    render();
};

window.agregar = function(){
    const codigo = document.getElementById("codigo").value.trim();
    const concepto = document.getElementById("concepto").value.trim();

    if(!codigo || !concepto){
        alert("Completa ambos campos");
        return;
    }

    lista.push({codigo, concepto});
    render();

    document.getElementById("codigo").value = "";
    document.getElementById("concepto").value = "";
};

window.guardar = async function(){
    await setDoc(doc(db,"fijos_auditoria","productos"), { lista });
    alert("Guardado correctamente");
};

cargar();
</script>

</body>
</html>
