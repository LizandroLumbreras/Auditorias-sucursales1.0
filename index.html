<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Auditor√≠a ‚Äì Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
 body{
   margin:0;
   font-family:'Poppins',sans-serif;
   background: linear-gradient(to right,#00416A,#0c6cbd);
   display:flex; justify-content:center; align-items:center;
   height:100vh; color:white;
 }

 .card{
   background:white;
   color:#222;
   padding:30px;
   width:90%; max-width:420px;
   border-radius:16px;
   box-shadow:0 8px 25px rgba(0,0,0,.25);
 }

 h2{
   text-align:center;
   color:#00416A;
 }

 input{
   width:100%; padding:14px;
   border-radius:10px; border:1px solid #ccc;
   margin-top:10px; font-size:15px;
 }

 button{
   width:100%; padding:14px;
   background:#00416A; color:white;
   border:none; border-radius:10px;
   margin-top:20px; font-size:17px;
   cursor:pointer; transition:.3s;
 }

 .error{
   color:red; display:none; text-align:center;
   margin-top:10px;
 }
</style>
</head>

<body>

<div class="card">
  <h2>Iniciar Sesi√≥n</h2>

  <label>Usuario:</label>
  <input id="usuario" placeholder="Ej. LIZANDRO">

  <label>Contrase√±a:</label>
  <input id="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">

  <div id="msg" class="error">Usuario o contrase√±a incorrectos</div>

  <button onclick="login()">Entrar</button>
</div>

<script type="module">
import { db } from "./firebase.js";
import { collection, getDocs } 
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

async function login(){

    const userInput = usuario.value.trim();
    const passInput = password.value.trim();
    const msg       = document.getElementById("msg");
    msg.style.display = "none";

    if(!userInput || !passInput){
        msg.textContent = "Completa todos los campos";
        msg.style.display = "block";
        return;
    }

    const snap = await getDocs(collection(db, "usuarios_ruta"));

    let usuarioData = null;

    snap.forEach(doc=>{
        const x = doc.data();
        if(x.usuario === userInput && x.password === passInput && x.activo === true){
            usuarioData = x;
        }
    });

    if(!usuarioData){
        msg.textContent = "Usuario o contrase√±a incorrectos";
        msg.style.display = "block";
        return;
    }

    // GUARDAR DATOS EN LOCALSTORAGE
    localStorage.setItem("aud_nombre",   usuarioData.nombre);
    localStorage.setItem("aud_sucursal", usuarioData.rutaId);
    localStorage.setItem("aud_usuario",  usuarioData.usuario);

    // FECHA AUTOM√ÅTICA
    const fecha = new Date().toISOString().slice(0,16);
    localStorage.setItem("aud_fecha", fecha);

    // üî• RUTA SEG√öN EL ROL
    if(usuarioData.rol === "admin"){
        localStorage.setItem("admin_login","true");
        window.location = "admin_dashboard.html"; // MODULO ADMIN
    }else{
        window.location = "inventario.html"; // MODULO USUARIO
    }
}

window.login = login;
</script>

</body>
</html>
