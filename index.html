<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Auditoría – Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
 body{
   margin:0;
   font-family:'Poppins',sans-serif;
   background: linear-gradient(to right,#00416A,#0c6cbd);
   display:flex; justify-content:center; align-items:center;
   height:100vh; color:white;
 }

 .card{
   background:white;
   color:#222;
   padding:30px;
   width:90%; max-width:420px;
   border-radius:16px;
   box-shadow:0 8px 25px rgba(0,0,0,.25);
   animation:fade 0.6s ease;
 }

 @keyframes fade{
   from{opacity:0; transform:translateY(20px);}
   to{opacity:1;}
 }

 h2{
   text-align:center;
   color:#00416A;
   font-weight:600;
   margin-bottom:20px;
 }

 input{
   width:100%; padding:14px;
   border-radius:10px; border:1px solid #ccc;
   margin-top:10px; font-size:15px;
 }

 button{
   width:100%; padding:14px;
   background:#00416A; color:white;
   border:none; border-radius:10px;
   margin-top:20px; font-size:17px;
   cursor:pointer; transition:.3s;
 }
 button:hover{ background:#0c6cbd; }

 .error{
   color:red;
   font-size:14px;
   margin-top:10px;
   display:none;
   text-align:center;
 }
</style>
</head>

<body>

<div class="card">
  <h2>Iniciar Sesión</h2>

  <label>Usuario:</label>
  <input id="usuario" placeholder="Ej: LIZANDRO">

  <label>Contraseña:</label>
  <input id="password" type="password" placeholder="•••••••">

  <div id="msg" class="error">Usuario o contraseña incorrectos</div>

  <button onclick="login()">Entrar</button>
</div>

<script type="module">
import { db } from "./firebase.js";
import { collection, getDocs } 
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

async function login(){

    const userInput = usuario.value.trim();
    const passInput = password.value.trim();
    const msg = document.getElementById("msg");

    msg.style.display = "none";

    if(!userInput || !passInput){
        msg.textContent = "Llena todos los campos";
        msg.style.display = "block";
        return;
    }

    // Leer usuarios desde Firestore
    const snap = await getDocs(collection(db, "usuarios_ruta"));

    let encontrado = null;

    snap.forEach(doc=>{
        const u = doc.data();

        if(u.usuario === userInput && u.password === passInput && u.activo === true){
            encontrado = u;
        }
    });

    if(!encontrado){
        msg.textContent = "Usuario o contraseña incorrectos";
        msg.style.display = "block";
        return;
    }

    // Guardar credenciales en localStorage
    localStorage.setItem("aud_sucursal", encontrado.rutaId);
    localStorage.setItem("aud_nombre", encontrado.nombre);
    localStorage.setItem("aud_usuario", encontrado.usuario);

    // Fecha automática
    const fecha = new Date().toISOString().slice(0,16);
    localStorage.setItem("aud_fecha", fecha);

    // Continuar a la auditoría
    window.location = "inventario.html";
}

window.login = login;

</script>

</body>
</html>
